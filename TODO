TODO

+прикрутить логгер

+1.RESTLER RPC API для считывания/установки значений свойств объектов и асинхронного запуска скриптов
+2. Отправка значений свойсв в graphite c кастомными метриками те для любого свойства объекта м.б. установлена метрика (отправка в Graphite в случае изменения значения)
	имееи ли смысл кастомизировать метрики, есть объект и именованное св-во - это и есть имя метрики? +сделано пока так
+2.1. понять как обновляются св-ва объека на примере 1wire

+3.Настроить слив данных из 1wire в Graphite через set

+тег 0.0.3
в файле Index.php перейти на фасад
сделать клон БД для тестов и перейти на него

тег 0.0.4

настройкли для graphite вынести в конфиг
разобраться как работает бекапирование в панели управления (оставить только создание бекапа динамических данных и БД)


тег 0.0.5

4. Первести все директории с динамическими данными типа backup, cache и пр. в место отдельное от кода, хранить в конфигах


'CacheDir' => '/home/projects/data/majordomo/cache/',
./cached/
./cms/
./debmes/
./modules/
./templates/
./objects/
./rc/
./saverestore/ 



тег 0.0.6
разобраться с сценами, научисть включать/выключать (дергать url) по нажатию на "лампу"  (изучить асинхронный вариант с ajax)
попутно разобраться с директорией cms




доделать перевод директорий с динамическими данными
'CmsDir' => '/home/projects/data/majordomo/cms/',
'TextsDir' => '/home/projects/data/majordomo/texts/',
'SoundsDir' => '/home/projects/data/majordomo/sounds/',


!!разобраться как работают всплывающе окна и определение работы скрипта cycle_work (часто глючит и неправильно определяет)
!!разобраться с командами - http://192.168.1.120:185/index.php?pd=pz_pz_YXBwbGljYXRpb246e2FjdGlvbj1tZW51fQ%3D%3Dpz_&md=shoutbox&inst=&&limit=10&msg=test


тег 0.0.6

Убрать омомо и запушить?
10. Настролить мониторинг на отсутсвие показателей в Graphite (развернуть GraphiteMonitProject)
   5.1 интегрировать с majordomo (минимум добавиь страницу с оповещениями + всплывающие окна, максимум Growl)


N.переделать objects in active record


!через час работы крона вылезла ошибка + 1wire перестал обновляться
!упал owfs сервер, почему неясно

Единый концепт подключаемых можулей, сейчас это 2е отдельные папки Templates и modules


tar -cvzf ./majordomo_20130929.tar.gz ./majordomo


/****************************************************************************************/


реализовать нечто типа Объекта, умеющее дергать API c Помощью Json POst Запросов
причем урл, который необходимо дергать и паарметры указываются в коде метода объекта
Возможно стоит использовать стандартный коллер, но есть ньюанс - пока он вызывается, запрос выполняется в браузере, возможно тут стоит использовать асинхронный механизм
!!использовать addScheduledJob


Модель
1 Есть класс Caller, умеющий дергать POST
2. Есть глобальный метод (AddImmediateJob) с указанием IOC объекта, метода и параметров, метод можно вызывать из сценариев MD, причем можно указать в какой Свойство записать ответ.
3. Делаем объект, в сценарии ставим имя метода, жмем на Сцену - ставится задача, крон выполняет задачу и записывает результат в Свойство объекта
4.Сцена выполняет апдейт и цепляет Свойство объекта

1.Реализовать методы для добавления ForceJob (задания требующего немедленного выполнения)
   * с указанием IOC объекта, метода и параметров: Объекта и св-ва куда возвращать результат
   * с указанием объекта и метода, который необходимо вызвать: Объекта и св-ва куда возвращать результат
   * с указанием сценария, который необходимо выполнить: Объекта и св-ва куда возвращать результат

2. Реализовать крон, обрабатывающий подобные задания (sleep 1 сек т.е. он будет постоянно долбить БД, простой макс - 1 мин), запуск вне главного цикла, отдельная таблица


plugin
   config/config.php
   src/
     *классы


В Сценарии можно подгрузить необходимый плагин
затем вызвать стандартный метод плагина


Plugin API For Device:

GetName()
GetVersion()
GetPortVal($device, $port)
SetPortVal($device, $port, $val)
GetPorts() return array ($port => $options,)
GetPortOptions($port)



Метод объекта в итоге выглядит так:

$plugin = LoadPlugin('pluginName');
$ret = $plugin->SetPort(DEVICE_NAME, имя порта, значение);
$this->имя Свойства = $ret;


Либо через Job
$plugin = LoadPlugin('pluginName');
AddJob($plugin, 'SetPort', имя порта, значение, $this->name, имя Свойства);




******

что менялось 
1  - DevicePlugins
2 - lib/common.class.php, general.class, mysql.class
3 - cron_workers
4 - таблицы в БД

CREATE TABLE `device_plugin` (                             
CREATE TABLE `devices` (                             
CREATE TABLE `device_plugin_job` (                           


+протестить создание.выполнение работ через новый крон 
+ LoadModules

********************


Завести страницу со списком Device c возможностью добавления/удаления свойств и пр.

добавить папки device в modules and tremplates
add record into project_modules
add record into admin_users



*********************************

1) Автоматически добавлять св-ва из плагина +
2) реализовать скрипт сбора данных +
3) реализовать API для обновления данных внешними системами

alter table script set text

0.0.5b10

4) реализовать Readonly св-ва ?



в сценах разобраться как будет работать клик с новыми ус-вами
как вариант runDevicePluginJob() изменить логику работы на device->setProperty
либо сделать доп ветку по команде = setProperty

вот так выглядит установка св-ва device через постановку задачи
addDevicePluginJob('dev1124111114', 'SetProperty', 'p1', '7', '', '', null);

соответственно при выполнении из сцен должно вызываться нечто такое
если на каждый девайс будет свой объект, то в его методе должно выполняться нечто такое


Итог:
Управление megad через сцены (отображение и установка данных)







/********************/
ДОбавление новых устройств через фейс
Крависвое отображение на сценах с возможносьбю управления, например открывать менюшку со слайдером
для Hc графиков aggregationType влияет на типы 2,3,4

/*******************/
Вкладка задания по расписанию, аналог кронов
лучше тупо день недели/число, время запуска, время окончания (NULL)
ДЕйсвия при запуске (сценарий, код, установка св-ва)
действя по окончанию

Блок по числам   Блок по дням недели
				 ПН, ВТ...
крыжик день
крыжик месяц 
крыжик код

поле ввода, календарь
время поле ввода

крыжик регулярно

в итоге запись в формате крона

условия для запуска, например значение некого ообъекта
/*************************************/
нужно для управления температурой ТП по расписанию

пн-пт 6:00 включать до 30 гр
           выключать 9:00 20 гр



/***********************/
Модуль мониторинга
Следит за изменениями св-в объектов и если они становятся хреновыми оповещает, взять модель триггеров из заббикса
Оповещает полькователей, выбор из списка
У каждого пользователя есть способы оповещения
+Цвет алерта










